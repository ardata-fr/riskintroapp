% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/module-edit-risk-factors.R
\name{riskFactorEditorServer}
\alias{riskFactorEditorServer}
\title{Risk Factor Editor Server Logic}
\usage{
riskFactorEditorServer(id, emission_risk_factors, country_id, current_weights)
}
\arguments{
\item{id}{Character string. The namespace identifier matching the UI function.}

\item{emission_risk_factors}{Reactive expression returning the current emission risk factors dataset.
Should have the same structure as \code{\link[riskintrodata:get_wahis_erf]{riskintrodata::get_wahis_erf()}}.}

\item{country_id}{Reactive expression returning the ISO3 country code being edited.}

\item{current_weights}{reactive value containing list of emission risk factor weights.}
}
\value{
A reactive expression that returns updated data when Apply is clicked,
or delete operation when Delete is clicked, or NULL when Cancel is clicked.
}
\description{
Handles the server-side logic for the emission risk factor editor modal.
Manages data population, real-time score calculations, input validation, and data persistence.
}
\section{Data Format}{

The server handles conversion between data storage format and UI format:

\strong{Storage format (in dataset)}:
\itemize{
\item \code{0} = measure is in place (no risk)
\item \code{1} = no measure in place (risk present)
\item \code{NA} = unknown status (treated as risk present)
}

\strong{UI format (prettySwitch)}:
\itemize{
\item \code{FALSE} = measure in place (switch OFF = no risk)
\item \code{TRUE} = no measure in place (switch ON = risk present)
}
}

\section{Real-time Calculations}{

The interface provides live feedback as users adjust inputs:
\itemize{
\item Individual factor scores update immediately
\item Subtotals for each category (surveillance, control, commerce, epidemiological)
\item Grand total emission score out of 12
\item Uses \code{\link[riskintroanalysis:calc_emission_risk]{riskintroanalysis::calc_emission_risk()}} for consistency with actual calculations
}
}

\section{Return Values}{

The server returns a list with the following structure:
\itemize{
\item \strong{Apply operation}: \code{list(operation = "upsert", id = country_id, data = updated_row)}
\item \strong{Delete operation}: \code{list(operation = "delete", id = country_id, data = NULL)}
\item \strong{Cancel operation}: Returns \code{NULL}
}
}

\seealso{
\code{\link[=riskFactorEditorUI]{riskFactorEditorUI()}} for the corresponding UI function

\code{\link[riskintroanalysis:calc_emission_risk]{riskintroanalysis::calc_emission_risk()}} for risk calculation details

\code{\link[riskintrodata:get_erf_weights]{riskintrodata::get_erf_weights()}} for emission factor weights

Other risk-factor-editor: 
\code{\link{riskFactorEditorUI}()}
}
\concept{risk-factor-editor}
\keyword{internal}
